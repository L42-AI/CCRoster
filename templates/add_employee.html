{% extends 'layout.html' %}

{% block content %}
<div class="container">
    <h1 class="my-4">Add Employee</h1>
    <form action="{{ url_for('process_employee') }}" method="POST">
        <div class="form-group">
            <input type="text" name="fname" class="form-control" placeholder="First Name" required>
        </div>
        <div class="form-group">
            <input type="text" name="lname" class="form-control" placeholder="Last Name" required>
        </div>
        <div class="form-group">
            <label for="maximum">Maximum Hours:</label>
            <input type="number" id="maximum" name="maximum" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="minimum">Maximum Hours:</label>
            <input type="number" id="minimum" name="minimum" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="wage">Wage:</label>
            <input type="number" step="0.01" id="wage" name="wage" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="level">Level:</label>
            <input type="number" id="level" name="level" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="task">Task:</label>
            <input type="text" id="task" name="task" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="location">Location:</label>
            <input type="number" id="location" name="location" class="form-control" required>
        </div>

        <h1>Manage Availabilities</h1>
        <div class="calendar-container">
            <div id="calendar"></div>
            <div class="grid-overlay"></div>
            <div class="grid-cells"></div>
        </div>
        <input type="hidden" id="availability" name="availability">
        <button type="submit" class="btn btn-primary">Add Employee</button>
    </form>
</div>
{% endblock %}
{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            selectMirror: true,
            events: [],
            dateClick: function(info) {
                calendar.changeView('timeGridDay', info.date);

                if (calendar.view.type === 'timeGridDay') {
                    calendar.setOption('select', function(info) {
                        var eventData = {
                            start: info.startStr,
                            end: info.endStr,
                        };
                        calendar.addEvent(eventData);

                        // Save the availability data to the hidden input field
                        var availabilityData = JSON.parse(document.getElementById('availability').value || '[]');
                        availabilityData.push(eventData);
                        document.getElementById('availability').value = JSON.stringify(availabilityData);

                        calendar.unselect();
                    });
                }
            },
        });

        calendar.render();
    });
</script>
{% endblock %}
